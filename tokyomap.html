<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- mapbox -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0px; bottom: 0; width: 100%; }
    </style>
    <!-- css -->
    <link href="./css/style.css" rel="stylesheet">

    <title>Document</title>
</head>
<body>
    
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="menu">
            <form id="target">
                
                <!-- Select a year -->
                <table class="years">
                    <tr>
                        <td class="year">
                            <input id="2022" value="2022" name="day" type="radio">
                            <label for="2022" class="WDay">2022年</label>
                        </td>
                        <td class="year">
                            <input id="2021" value="2021" name="day" type="radio">
                            <label for="2021" class="WEnd">2021年</label>
                        </td>
                    </tr>
                </table>

                <!-- Select an indicator -->
                <!-- indicator 01 - 10 -->
                <table>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="companies" value="companies" name="cat" type="radio">
                                <span class="datelabel">トップ企業</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="hotels" value="hotels" name="cat" type="radio">
                                <span class="datelabel">ホテル</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                     <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                </table>
                <!-- indicator 11 - 20 -->
                <table>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                     <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                </table>
                <!-- indicator 21 - 30 -->
                <table>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                     <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                </table>
                <!-- indicator 31 - 40 -->
                <table>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                     <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                        <td class="indicator">
                            <label>
                                <input id="dummy" value="dummy" name="cat" type="radio">
                                <span class="datelabel">place holder</span>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                </table>
            </form>

            <!-- Download an excel file -->
            <div class="dlbtn">
                <button><a href="./xlsx/dataset2022.xlsx" download="dataset2022.xlsx" style="text-decoration: none; color: black;">エクセル ダウンロード</a></button>
            </div>

        </div>
    </div>

    <!-- Mapbox -->
    <div id="map"></div>

    <script type="text/javascript"> 

        mapboxgl.accessToken = 'pk.eyJ1IjoibnlhbWF0byIsImEiOiJja2Y4dzNkOW8wY3MwMnFvM29iNnJzNzVzIn0.GHlHwu3r5YjKBU3qAKvccQ'
        const map = new mapboxgl.Map({
            container: 'map',
            style: "mapbox://styles/nyamato/ckt5grlhv20td17o5ijrf84wz",
            zoom: 12,
            center: [139.7674359838231, 35.68166005293442]
        });
            
        map.on('load', () => {

            var sourcelayer = [
                ['companies2022', './geojson/companies2022.geojson'],
                ['hotels2022', './geojson/hotels2022.geojson'],
                ['companies2021', './geojson/companies2021.geojson'],
                ['hotels2021', './geojson/hotels2021.geojson'],
            ]
        
            function addsourcelayer(d) {
                for (var i = 0; i < d.length; i++) {
                        map.addSource(d[i][0], {
                        type: 'geojson',
                        data: d[i][1],
                    })

                    map.addLayer({
                        id: d[i][0],
                        type: 'circle',
                        source: d[i][0],
                        paint: {
                            'circle-radius': 3,
                            'circle-stroke-width': 2,
                            'circle-color': 'red',
                            'circle-stroke-color': 'red'
                        },
                        layout: {
                            visibility: 'visible',
                        }
                    })
                    
                    // Create a popup, but don't add it to the map yet.
                    const popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });
                    
                    map.on('mouseenter', d[i][0], (e) => {
                        // Change the cursor style as a UI indicator.
                        map.getCanvas().style.cursor = 'pointer';
                        
                        // Copy coordinates array.
                        const coordinates = e.features[0].geometry.coordinates.slice();      
                        const description = e.features[0].properties.name;
                        console.log(description)
                        
                        // Ensure that if the map is zoomed out such that multiple copies of the feature are visible, 
                        // the popup appears over the copy being pointed to.
                        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                        }
                        
                        // Populate the popup and set its coordinates based on the feature found.
                        popup.setLngLat(coordinates).setHTML(description).addTo(map);
                    });
                    
                    map.on('mouseleave', d[i][0], () => {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });
                }
            }
            
            addsourcelayer(sourcelayer)

            /*
            Loads map based on selected date
            IMPORTANT: Add new dataset names into "layers" array
            */

            document.getElementById('target').addEventListener('change', function(e) {

                var cat = document.querySelector('input[name="cat"]:checked').value
                var day = document.querySelector('input[name="day"]:checked').value
                var clicked = cat+day
                console.log(clicked)

                var layers = [
                    'companies2022',
                    'hotels2022',
                    'companies2021',
                    'hotels2021',
                ]

                for (var i = 0; i < layers.length; i++) {
                    var layer = layers[i]
                    if (clicked === layer) {
                        map.setLayoutProperty(layer, 'visibility', 'visible')
                        var inactiveLayers = layers.filter(el => el !== layer)
                        for (var i = 0; i < inactiveLayers.length; i++) {
                            inactiveLayer = inactiveLayers[i]
                            map.setLayoutProperty(inactiveLayer, 'visibility', 'none')
                        }
                    } else {
                        map.setLayoutProperty(layer, 'visibility', 'none')
                    }
                }
            })
            
            document.getElementById('companies').click();
            document.getElementById('2022').click();

        });
        
    </script>

</body>
</html>
