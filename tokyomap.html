<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- mapbox -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
    <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0px; bottom: 0; left: 300px; width: 100%; }
    </style>


    <title>Document</title>
</head>
<body>
    
    <!-- Radio buttons -->


    <div class="dates">
        <form id="dates">
            <table>
                <tr>
                    <label class="datecat">
                        <span class="datelabel">トップ企業</span>
                        <input id="companies" value="companies" name="cat" type="radio">
                        <span class="checkmark"></span>
                    </label>
                </tr>
                <tr>
                    <label class="datecat">
                        <span class="datelabel">ホテル</span>
                        <input id="hotels" value="hotels" name="cat" type="radio">
                        <span class="checkmark"></span>
                    </label>
                </tr>
            </table>
            <table class="dateday">
                <tr>
                    <td>
                        <input id="2022" value="2022" name="day" type="radio">
                        <label for="2022" class="WDay">2022年</label>
                    </td>
                    <td>
                        <input id="2021" value="2021" name="day" type="radio">
                        <label for="2021" class="WEnd">2021年</label>
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <button><a href="./csv/places.csv" download="places.csv" style="text-decoration: none; color: black;">Download csv</a></button>

    <!-- Mapbox -->
    <div id="map"></div>

    <script type="text/javascript"> 

        mapboxgl.accessToken = 'pk.eyJ1IjoibnlhbWF0byIsImEiOiJja2Y4dzNkOW8wY3MwMnFvM29iNnJzNzVzIn0.GHlHwu3r5YjKBU3qAKvccQ'
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: "mapbox://styles/nyamato/ckt5grlhv20td17o5ijrf84wz",
            zoom: 12, // starting zoom
            center: [139.7674359838231, 35.68166005293442] // starting center
        });
            

                map.on('load', () => {

                    var sourcelayer = [
                    ['companies2022', './geojson/companies2022.geojson'],
                    ['hotels2022', './geojson/hotels2022.geojson'],
                    ['companies2021', './geojson/companies2021.geojson'],
                    ['hotels2021', './geojson/hotels2021.geojson'],
                ]
                
                function addsourcelayer(d) {
                    for(var i = 0; i < d.length; i++){
                        map.addSource(d[i][0], {
                        type: 'geojson',
                        data: d[i][1],
                        })
                        map.addLayer({
                            id: d[i][0],
                            type: 'circle',
                            source: d[i][0],
                            paint: {
                                'circle-radius': 3,
                                'circle-stroke-width': 2,
                                'circle-color': 'red',
                                'circle-stroke-color': 'red'
                            },
                            layout: {
                                visibility: 'visible',
                            }
                        })
                    }
                }
                
                addsourcelayer(sourcelayer)


                /*
                Loads map based on selected date
                IMPORTANT: Add new dataset names into "layers" array
                */

                document.getElementById('dates').addEventListener('change', function(e) {

                    var cat = document.querySelector('input[name="cat"]:checked').value
                    var day = document.querySelector('input[name="day"]:checked').value
                    var clicked = cat+day

                    console.log(clicked)


                    var layers = [
						'companies2022',
						'hotels2022',
						'companies2021',
						'hotels2021',
                    ]
                    for (var i = 0; i < layers.length; i++) {
                        var layer = layers[i]
                        if (clicked === layer) {
                            map.setLayoutProperty(layer, 'visibility', 'visible')
                            var inactiveLayers = layers.filter(el => el !== layer)
                            for (var i = 0; i < inactiveLayers.length; i++) {
                                inactiveLayer = inactiveLayers[i]
                                map.setLayoutProperty(inactiveLayer, 'visibility', 'none')
                            }
                        } else {
                            map.setLayoutProperty(layer, 'visibility', 'none')
                        }
                    }
                })
                
                document.getElementById('companies').click();
                document.getElementById('2022').click();

        
                });

     

                


        
    </script>

    

</body>
</html>
